name: Run Gradle on PRs
on: pull_request
jobs:
    gradle:
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest]
        runs-on: ${{ matrix.os }}
        steps:
            - uses: actions/checkout@v3
            - uses: actions/setup-java@v3
              with:
                  distribution: temurin
                  java-version: 11

            - name: Setup Gradle
              uses: gradle/gradle-build-action@v2
            - name: Install SDKMAN and Gradle Profiler
              run: |
                  curl -s "https://get.sdkman.io" | bash
                  source "$HOME/.sdkman/bin/sdkman-init.sh"
                  sdk install gradleprofiler 0.18.0
            - name: Execute Gradle build
              env:
                  GE_URL: ${{ secrets.GE_URL }}
                  GRADLE_ENTERPRISE_ACCESS_KEY: ${{ secrets.GRADLE_ENTERPRISE_ACCESS_KEY }}
              run: ./gradlew assembleDebug

            - name: Archive production artifacts
              uses: actions/upload-artifact@v3
              with:
                  name: cache
                  path: /home/runner/.gradle/caches/transforms-3/9a864bdf6138f0a2c754a9e732c2644a/transformed/output

    gradle2:
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest]
        runs-on: ${{ matrix.os }}
        steps:
            - uses: actions/checkout@v3
            - uses: actions/setup-java@v3
              with:
                  distribution: zulu
                  java-version: 11.0.4

            - name: Setup Gradle
              uses: gradle/gradle-build-action@v2
            - name: Install SDKMAN and Gradle Profiler
              run: |
                  curl -s "https://get.sdkman.io" | bash
                  source "$HOME/.sdkman/bin/sdkman-init.sh"
                  sdk install gradleprofiler 0.18.0
            - name: Execute Gradle build
              env:
                  GE_URL: ${{ secrets.GE_URL }}
                  GRADLE_ENTERPRISE_ACCESS_KEY: ${{ secrets.GRADLE_ENTERPRISE_ACCESS_KEY }}
              run: |
                git fetch origin
                git checkout main
                ./gradlew assembleDebug
            - name: Archive production artifacts
              uses: actions/upload-artifact@v3
              with:
                  name: cache1
                  path: /home/runner/.gradle/caches/transforms-3/bf1362543da86239151d00c56f0b4149/transformed/output

